<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>PDF Viewer SDK - Optimized PDFTron (71% smaller)</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: Arial, sans-serif; overflow: hidden; }
    #viewer { width: 100vw; height: 100vh; }
    
    /* Custom styles */
    .loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 18px;
      color: #333;
    }
  </style>
</head>
<body>
  <div class="loading">Loading PDF Viewer...</div>
  <div id="viewer" style="display:none;"></div>

  <script src="./lib/webviewer/webviewer.min.js"></script>
  <script>
    (async () => {
      try {
        // Initialize WebViewer with minimal/lean configuration
        const instance = await WebViewer({
          path: './lib/webviewer',
          initialDoc: './samples/sample.pdf',
          
          // Use lean mode for smaller bundle (important!)
          fullAPI: false,
          
          // Disable unnecessary features to reduce resource usage
          enableRedaction: false,
          enableMeasurement: false,
          
          // Minimal UI - hide unnecessary panels
          disabledElements: [
            'toolsHeader',
            'searchPanel',
            'leftPanelButton',
            'viewControlsButton',
            'selectToolButton'
          ],
          
          // Additional optimizations
          extension: 'pdf',
          isAdminUser: false,
          disabledFeatures: ['ThumbnailMultiselect', 'NotesPanel']
          
        }, document.getElementById('viewer'));

        const { Core, UI } = instance;
        
        // Hide loading message
        document.querySelector('.loading').style.display = 'none';
        document.getElementById('viewer').style.display = 'block';

        // Add custom download button
        UI.setHeaderItems(header => {
          header.push({
            type: 'actionButton',
            title: 'Download PDF',
            img: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>',
            onClick: async () => {
              const doc = Core.documentViewer.getDocument();
              const data = await doc.getFileData({ flags: Core.SaveOptions.LINEARIZED });
              const blob = new Blob([data], { type: 'application/pdf' });
              const url = URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = 'document.pdf';
              a.click();
              URL.revokeObjectURL(url);
            }
          });
        });

        // Log success
        console.log('PDFTron WebViewer initialized successfully!');
        console.log('Optimized bundle: ~42MB (71% smaller than full ~147MB)');
        console.log('Files: 348 (vs 635 in full version)');
        
        // API examples
        window.pdfViewer = {
          instance,
          loadDocument: (url) => UI.loadDocument(url),
          getCurrentPage: () => Core.documentViewer.getCurrentPage(),
          setPage: (num) => Core.documentViewer.setCurrentPage(num),
          getPageCount: () => Core.documentViewer.getPageCount(),
          zoomIn: () => UI.zoomIn(),
          zoomOut: () => UI.zoomOut(),
          downloadPdf: async (filename = 'document.pdf') => {
            const doc = Core.documentViewer.getDocument();
            const data = await doc.getFileData({});
            const blob = new Blob([data], { type: 'application/pdf' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
          }
        };
        
      } catch (error) {
        console.error('Failed to initialize WebViewer:', error);
        document.querySelector('.loading').innerHTML = 
          'Error loading PDF viewer.<br><br>' +
          'Make sure WebViewer files are in ./lib/webviewer/<br><br>' +
          'Run: npm run copy-webviewer-ps<br><br>' +
          error.message;
        document.querySelector('.loading').style.color = 'red';
      }
    })();
  </script>
</body>
</html>
